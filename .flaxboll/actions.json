{"1770841480134":{"actionType":"saveAll","createdAt":"1770841480134","actionID":"1770841480134","userID":"#TEMP","path":"system.capsules.173c20ee-621c-4438-9164-32bc13d3365e.capsUseCodeInfo.capsUseDescription.en","oldValue":"() => {\n  const cart = tools.getCtData(\"sc.C4.forms.iptsChanges.products\") || [];\n\n  function parsePrice(p) {\n    if (!p || typeof p !== \"string\") return 0;\n    const cleaned = p\n      .replace(\"R$\", \"\")\n      .replace(/\\s+/g, \"\")\n      .replace(/\\./g, \"\")\n      .replace(\",\", \".\")\n      .trim();\n    const num = Number(cleaned);\n    return isNaN(num) ? 0 : num;\n  }\n\n  let total = 0;\n\n  for (let i = 0; i < cart.length; i++) {\n    const item = cart[i];\n    const price = parsePrice(item.price);\n    total += price;\n  }\n\n  const formatted = total.toLocaleString(\"pt-BR\", {\n    style: \"currency\",\n    currency: \"BRL\",\n  });\n\n  tools.functions.setVar({\n    args: \"\",\n    pass: {\n      keyPath: [\"sc.C4.forms.iptsChanges.totalPrice\"],\n      value: [formatted],\n    },\n  });\n\n  return formatted;\n}","newValue":""}}